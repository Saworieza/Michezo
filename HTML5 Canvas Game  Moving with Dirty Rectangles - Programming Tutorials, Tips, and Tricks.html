<!DOCTYPE html>
<!-- saved from url=(0060)http://blog.sklambert.com/html5-canvas-game-the-player-ship/ -->
<html lang="en-US"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><link rel="stylesheet" type="text/css" href="./HTML5 Canvas Game  Moving with Dirty Rectangles - Programming Tutorials, Tips, and Tricks_files/bY1LCoAwDEQvJMTexQvUJtTYL01EenvFhQvtamZ4D8bATlqtC5AKHpEE5FjFNa7KJX_WNIOEaNNKTZeNEoGTW9EeaYxqY0mT-X2cjJ70zYEhm22EFrE_lbO_AA.css" media="all"><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="twitter:card" content="summary"><meta name="twitter:site" content="@StevenKLambert"><meta name="twitter:creator" content="@StevenKLambert"><meta name="twitter:title" content="HTML5 Canvas Game: The Player Ship"><meta name="twitter:description" content="In this second installment of the Galaxian Style HTML5 game series, I&#39;ll be showing you how to create movement on the canvas by using dirty rectangles."><meta name="twitter:image:src" content="http://blog.sklambert.com/wp-content/uploads/2012/12/ship_on_bg.png"><title>HTML5 Canvas Game: Moving with Dirty Rectangles - Programming Tutorials, Tips, and Tricks</title><link rel="icon" type="image/ico" href="http://blog.sklambert.com/wp-content/themes/sklambertTheme/imgs/favicon.ico"><meta name="description" content="In this second installment of the Galaxian Style HTML5 game series, I&#39;ll be showing you how to create movement on the canvas by using dirty rectangles."><link rel="canonical" href="./HTML5 Canvas Game  Moving with Dirty Rectangles - Programming Tutorials, Tips, and Tricks_files/HTML5 Canvas Game  Moving with Dirty Rectangles - Programming Tutorials, Tips, and Tricks.html"> <script src="./HTML5 Canvas Game  Moving with Dirty Rectangles - Programming Tutorials, Tips, and Tricks_files/cb=gapi.loaded_1" async=""></script><script src="./HTML5 Canvas Game  Moving with Dirty Rectangles - Programming Tutorials, Tips, and Tricks_files/cb=gapi.loaded_0" async=""></script><script type="text/javascript" async="" src="./HTML5 Canvas Game  Moving with Dirty Rectangles - Programming Tutorials, Tips, and Tricks_files/plusone.js" gapi_processed="true"></script><script type="text/javascript" async="" src="./HTML5 Canvas Game  Moving with Dirty Rectangles - Programming Tutorials, Tips, and Tricks_files/ga.js"></script><script type="text/javascript" src="./HTML5 Canvas Game  Moving with Dirty Rectangles - Programming Tutorials, Tips, and Tricks_files/M9bPKixNLarUMYYydHMz04sSS1L1cjPzAA.js"></script><link rel="shortlink" href="http://wp.me/p2qsZ3-a1"><script type="text/javascript">/*<![CDATA[*/function external_links_in_new_windows_loop(){if(!document.links){document.links=document.getElementsByTagName('a');}
var change_link=false;var force='';var ignore='';for(var t=0;t<document.links.length;t++){var all_links=document.links[t];change_link=false;if(document.links[t].hasAttribute('onClick')==false){if(all_links.href.search(/^http/)!=-1&&all_links.href.search('blog.sklambert.com')==-1){change_link=true;}
if(force!=''&&all_links.href.search(force)!=-1){change_link=true;}
if(ignore!=''&&all_links.href.search(ignore)!=-1){change_link=false;}
if(change_link==true){document.links[t].setAttribute('onClick','javascript:window.open(\''+all_links.href+'\'); return false;');document.links[t].removeAttribute('target');}}}}
function external_links_in_new_windows_load(func)
{var oldonload=window.onload;if(typeof window.onload!='function'){window.onload=func;}else{window.onload=function(){oldonload();func();}}}
external_links_in_new_windows_load(external_links_in_new_windows_loop);/*]]>*/</script><script type="text/javascript">window._zem_rp_blog_id='6970965';window._zem_rp_post_id='621';window._zem_rp_thumbnails=true;window._zem_rp_post_title='HTML5+Canvas+Game%3A+The+Player+Ship';window._zem_rp_post_tags=['galaxian','game+development','html5','javascript','tutorial','tutorials','ship','rectangl','shoot','style','game','alta','tutori','thea','pan','arrow','html5','space','html','canva','shooter'];window._zem_rp_static_base_url='http://content.zemanta.com/static/';window._zem_rp_wp_ajax_url='http://blog.sklambert.com/wp-admin/admin-ajax.php';window._zem_rp_plugin_version='1.8.1';window._zem_rp_num_rel_posts='5';window._zem_rp_remote_recommendations=false;</script><script type="text/javascript" src="./HTML5 Canvas Game  Moving with Dirty Rectangles - Programming Tutorials, Tips, and Tricks_files/pageview.js" async=""></script><link rel="stylesheet" href="http://blog.sklambert.com/wp-content/plugins/related-posts-by-zemanta/static/themes/vertical-m.css?version=1.8.1"><style type="text/css">img#wpstats{display:none}</style><script type="text/javascript">var _gaq=_gaq||[];_gaq.push(['_setAccount','UA-32599230-1']);_gaq.push(['_setDomainName','sklambert.com']);_gaq.push(['_trackPageview']);(function(){var ga=document.createElement('script');ga.type='text/javascript';ga.async=true;ga.src=('https:'==document.location.protocol?'https://ssl':'http://www')+'.google-analytics.com/ga.js';var s=document.getElementsByTagName('script')[0];s.parentNode.insertBefore(ga,s);})();</script><script async="" type="text/javascript" src="./HTML5 Canvas Game  Moving with Dirty Rectangles - Programming Tutorials, Tips, and Tricks_files/count.js"></script><script async="" src="./HTML5 Canvas Game  Moving with Dirty Rectangles - Programming Tutorials, Tips, and Tricks_files/count-data.js"></script></head><body class="single single-post postid-621 single-format-standard"> <header class="site-header" role="banner"><div class="container"> <section class="header-group"> <a class="logo" href="http://blog.sklambert.com/" rel="home"> <span class="assistive-text">HTML5 Gamer</span> </a><h1 class="site-title"><a class="title-link" href="http://blog.sklambert.com/" rel="home">HTML5 Gamer</a></h1><p class="site-description"><a class="title-link" href="http://blog.sklambert.com/" rel="home">JavaScript and HTML5 Game Development</a></p> </section><form method="get" class="search-form" action="http://blog.sklambert.com/" role="search"> <label for="s" class="assistive-text">Search</label> <input type="text" class="search-input" name="s" value="" id="s" placeholder="Search …"> <button type="submit" class="icon-search search-submit" value=""></button></form></div> </header> <nav class="site-navigation" role="navigation"><div class="container"><h1 class="assistive-text">Menu</h1> <a href="http://blog.sklambert.com/html5-canvas-game-the-player-ship/#content" class="assistive-text skip-link" title="Skip to main content">Skip to main content</a><div class="mobile-menus mobile-memu-container"> <a id="toggle-menu" href="http://blog.sklambert.com/html5-canvas-game-the-player-ship/#" class="mobile-menu">☰ Menu</a></div><div class="menu-master-container"><ul id="menu-master" class="menu"><li id="menu-item-253" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home menu-item-253"><a class="menu-link" href="http://blog.sklambert.com/">Home</a></li><li id="menu-item-1310" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-1310"><a class="menu-link" href="http://blog.sklambert.com/category/articles/">Articles</a></li><li id="menu-item-1311" class="menu-item menu-item-type-taxonomy menu-item-object-category current-post-ancestor current-menu-parent current-post-parent menu-item-1311"><a class="menu-link" href="http://blog.sklambert.com/category/tutorials/">Tutorials</a></li><li id="menu-item-1507" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-1507"><a class="menu-link" href="http://blog.sklambert.com/games/">Games</a></li><li id="menu-item-777" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-777"><a class="menu-link" href="http://blog.sklambert.com/jetpack-post-views/">WP Plugins</a></li><li id="menu-item-1312" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-1312"><a class="menu-link" href="http://blog.sklambert.com/archives/">Archives</a></li></ul></div><div class="mobile-menus mobile-search-container"> <a id="toggle-search" href="http://blog.sklambert.com/html5-canvas-game-the-player-ship/#" class="mobile-search icon-search">&nbsp;</a></div></div> </nav> <main role="main"> <section id="content" class="main"> <article id="post-621" class="post-621 post type-post status-publish format-standard hentry category-tutorials tag-galaxian tag-game-development tag-html5 tag-javascript tag-tutorial entry-content"> <header class="entry-header"><h1 class="entry-title">HTML5 Canvas Game: The Player Ship</h1><div class="entry-meta"><time class="entry-date icon-calendar" datetime="2012-12-20T12:16:35+00:00" pubdate="">December 20, 2012</time><span class="entry-categories icon-folder"><a href="http://blog.sklambert.com/category/tutorials/" title="View all posts in Tutorials" rel="category tag">Tutorials</a></span><span class="entry-tags icon-tags"><a href="http://blog.sklambert.com/tag/galaxian/" rel="tag">Galaxian</a>, <a href="http://blog.sklambert.com/tag/game-development/" rel="tag">Game Development</a>, <a href="http://blog.sklambert.com/tag/html5/" rel="tag">HTML5</a>, <a href="http://blog.sklambert.com/tag/javascript/" rel="tag">JavaScript</a>, <a href="http://blog.sklambert.com/tag/tutorial/" rel="tag">Tutorial</a></span><span class="entry-comments icon-bubbles"><a href="http://blog.sklambert.com/html5-canvas-game-the-player-ship/#disqus_thread" title="Comment on HTML5 Canvas Game: The Player Ship" data-disqus-identifier="621 http://blog.sklambert.com/?p=621">30 Comments</a></span></div> </header><div class="sharedaddy sd-sharing-enabled"><div class="robots-nocontent sd-block sd-social sd-social-official sd-sharing"><h3 class="sd-title">Share this:</h3><div class="sd-content"><ul><li class="share-twitter"><div class="twitter_button"><iframe allowtransparency="true" frameborder="0" scrolling="no" src="./HTML5 Canvas Game  Moving with Dirty Rectangles - Programming Tutorials, Tips, and Tricks_files/tweet_button.html" style="width:101px; height:20px;"></iframe></div></li><li class="share-google-plus-1"><div class="googleplus1_button"><div id="___plus_0" style="text-indent: 0px; margin: 0px; padding: 0px; background-color: transparent; border-style: none; float: none; line-height: normal; font-size: 1px; vertical-align: baseline; display: inline-block; width: 82px; height: 20px; background-position: initial initial; background-repeat: initial initial;"><iframe frameborder="0" hspace="0" marginheight="0" marginwidth="0" scrolling="no" style="position: static; top: 0px; width: 82px; margin: 0px; border-style: none; left: 0px; visibility: visible; height: 20px;" tabindex="0" vspace="0" width="100%" id="I0_1399294106867" name="I0_1399294106867" src="./HTML5 Canvas Game  Moving with Dirty Rectangles - Programming Tutorials, Tips, and Tricks_files/sharebutton.html" data-gapiattached="true" title="+Share"></iframe></div></div></li><li class="share-facebook"><div class="like_button"><iframe src="./HTML5 Canvas Game  Moving with Dirty Rectangles - Programming Tutorials, Tips, and Tricks_files/like.html" scrolling="no" frameborder="0" style="border:none; overflow:hidden; width:96px; height:21px;" allowtransparency="true"></iframe></div></li><li class="share-end"></li></ul></div></div></div><div class="featured-image"></div><meta name="description" content="In this second installment of the Galaxian Style HTML5 game series, I&#39;ll be showing you how to create movement on the canvas by using dirty rectangles."><div class="series-next-prev-wrapper top"><div class="series-prev"> <a href="http://blog.sklambert.com/html5-canvas-game-panning-a-background/" title="HTML5 Canvas Game: Panning a Background" class="series-prev-link">« Previous series post</a></div><div class="series-next"> <a href="http://blog.sklambert.com/html5-canvas-game-the-enemy-ships/" title="HTML5 Canvas Game: The Enemy Ships" class="series-next-link">Next series post »</a></div></div><p><img class=" wp-image-622 alignnone" alt="A space ship on a starry background in space" src="./HTML5 Canvas Game  Moving with Dirty Rectangles - Programming Tutorials, Tips, and Tricks_files/ship_on_bg.png" width="300" height="180"></p><p>In this second&nbsp;installment&nbsp;of the&nbsp;<a href="http://blog.sklambert.com/galaxian-html5-game/">Galaxian Style HTML5 game</a>&nbsp;series (which has been a long time coming),&nbsp;&nbsp;I’ll be showing you how to create movement on the canvas by using techniques such as dirty rectangles, multiple canvases, and object pools. So sit back, relax, and let’s get to it!</p><p><span id="more-621"></span></p><p>Difficulty:&nbsp;Medium<br> Languages:&nbsp;<abbr>HTML5</abbr>, JavaScript<br> Code:&nbsp;<a href="https://github.com/straker/galaxian-canvas-game/tree/master/part2" onclick="javascript:window.open(&#39;https://github.com/straker/galaxian-canvas-game/tree/master/part2&#39;); return false;">https://github.com/straker/galaxian-canvas-game/tree/master/part2</a></p><h2 id="part" class="sub-title"><a href="http://blog.sklambert.com/html5-canvas-game-the-player-ship/#part" class="permalink" title="Link to this section">Part 2</a></h2><p>Let’s begin by seeing the final result of this tutorial. Make sure you click inside the game if the controls&nbsp;aren’t&nbsp;working.</p><p>Controls: Move – Arrow keys (<span style="line-height: 24px;">←</span><span style="line-height: 24px;">↑</span>↓→)<br> <span class="spacer">Shoot – Spacebar</span></p><p><iframe src="./HTML5 Canvas Game  Moving with Dirty Rectangles - Programming Tutorials, Tips, and Tricks_files/space_shooter_part_two.html" height="410" width="650"></iframe>Nothing too fancy, but we are getting a ship to move and shoot in the game while maintaining 60FPS.</p><h3 id="the-html-page" class="sub-title"><a href="http://blog.sklambert.com/html5-canvas-game-the-player-ship/#the-html-page" class="permalink" title="Link to this section">The HTML Page</a></h3><p>Again, we’ll first start out with the webpage.</p><div class="code-block"><pre class=" language-markup"><code class=" language-markup"><span class="token doctype">&lt;!DOCTYPE html&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>Space Shooter Demo<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>
		<span class="token style"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">&gt;</span></span>
			<span class="token selector">canvas </span><span class="token punctuation">{</span>
				<span class="token property">position</span><span class="token punctuation">:</span> absolute<span class="token punctuation">;</span>
				<span class="token property">top</span><span class="token punctuation">:</span> 0px<span class="token punctuation">;</span>
				<span class="token property">left</span><span class="token punctuation">:</span> 0px<span class="token punctuation">;</span>
				<span class="token property">background</span><span class="token punctuation">:</span> transparent<span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
			<span class="token selector">#background </span><span class="token punctuation">{</span>
				<span class="token property">z-index</span><span class="token punctuation">:</span> -2<span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
			<span class="token selector">#main </span><span class="token punctuation">{</span>
				<span class="token property">z-index</span><span class="token punctuation">:</span> -1<span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
			<span class="token selector">#ship </span><span class="token punctuation">{</span>
				<span class="token property">z-index</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">&gt;</span></span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
		&lt;!– The canvas for the panning background –&gt;
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>canvas</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>background<span class="token punctuation">"</span></span> <span class="token attr-name">width</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>600<span class="token punctuation">"</span></span> <span class="token attr-name">height</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>360<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
			Your browser does not support canvas. Please try again with a different browser.
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>canvas</span><span class="token punctuation">&gt;</span></span>
		&lt;!– The canvas for all enemy ships and bullets –&gt;
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>canvas</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>main<span class="token punctuation">"</span></span> <span class="token attr-name">width</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>600<span class="token punctuation">"</span></span> <span class="token attr-name">height</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>360<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>canvas</span><span class="token punctuation">&gt;</span></span>
		&lt;!– The canvas the ship uses (can only move up
         one forth the screen.) –&gt;
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>canvas</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>ship<span class="token punctuation">"</span></span> <span class="token attr-name">width</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>600<span class="token punctuation">"</span></span> <span class="token attr-name">height</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>360<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>canvas</span><span class="token punctuation">&gt;</span></span>
		<span class="token script"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>space_shooter_part_two.js<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>A few things have changed, mainly adding two more canvases to the page and styles to stack them in their proper order on the screen. We will be using three canvases for our game because it allows us to not have to <a href="http://atomicrobotdesign.com/blog/web-development/html5-canvas-you-dont-always-have-to-clear-the-entire-thing/" onclick="javascript:window.open(&#39;http://atomicrobotdesign.com/blog/web-development/html5-canvas-you-dont-always-have-to-clear-the-entire-thing/&#39;); return false;">redraw the entire game each frame</a>.</p><p>One canvas will be for the scrolling background which moves each frame. Another canvas&nbsp;will be used for the player ship because the player ship may or may not be moving each frame. The last canvas&nbsp;will be used for the bullets which move each frame once they are on the screen. The reason we use three canvases in this way will be explained later on.</p><p>We also removed the <code>onload="init()"</code> event from the body tag. I’ll explain why we did this in just a bit.</p><h3 id="drawable" class="sub-title"><a href="http://blog.sklambert.com/html5-canvas-game-the-player-ship/#drawable" class="permalink" title="Link to this section">Drawable</a></h3><p>The first thing we need to do after the HTML is update the <code>init()</code> function of the <code>Drawable</code> object.</p><div class="code-block"><pre class=" language-javascript"><code class=" language-javascript"><span class="token keyword">function</span> <span class="token function">Drawable<span class="token punctuation">(</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	this<span class="token punctuation">.</span>init <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> width<span class="token punctuation">,</span> height<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token comment" spellcheck="true">	// Defualt variables
</span>		this<span class="token punctuation">.</span>x <span class="token operator">=</span> x<span class="token punctuation">;</span>
		this<span class="token punctuation">.</span>y <span class="token operator">=</span> y<span class="token punctuation">;</span>
		this<span class="token punctuation">.</span>width <span class="token operator">=</span> width<span class="token punctuation">;</span>
		this<span class="token punctuation">.</span>height <span class="token operator">=</span> height<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Since we are adding images that no longer fill the entire canvas, we need to set the height and width of each object to it’s associated image. This will help us later as we try to draw and then clear each object from the screen.</p><h3 id="the-imagerepository" class="sub-title"><a href="http://blog.sklambert.com/html5-canvas-game-the-player-ship/#the-imagerepository" class="permalink" title="Link to this section">The imageRepository</a></h3><p>With the <code>Drawable</code> object updated, we’ll next update the <code>imageRepository</code> object.</p><div class="code-block"><pre class=" language-javascript"><code class=" language-javascript"><span class="token comment" spellcheck="true">/**
 * Define an object to hold all our images for the game so images
 * are only ever created once. This type of object is known as a
 * singleton.
 */</span>
<span class="token keyword">var</span> imageRepository <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token comment" spellcheck="true">	// Define images
</span>	this<span class="token punctuation">.</span>background <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Image</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	this<span class="token punctuation">.</span>spaceship <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Image</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	this<span class="token punctuation">.</span>bullet <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Image</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">	// Ensure all images have loaded before starting the game
</span>	<span class="token keyword">var</span> numImages <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>
	<span class="token keyword">var</span> numLoaded <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
	<span class="token keyword">function</span> <span class="token function">imageLoaded<span class="token punctuation">(</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		numLoaded<span class="token operator">++</span><span class="token punctuation">;</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>numLoaded <span class="token operator">===</span> numImages<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			window<span class="token punctuation">.</span><span class="token function">init<span class="token punctuation">(</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
	this<span class="token punctuation">.</span>background<span class="token punctuation">.</span>onload <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token function">imageLoaded<span class="token punctuation">(</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	this<span class="token punctuation">.</span>spaceship<span class="token punctuation">.</span>onload <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token function">imageLoaded<span class="token punctuation">(</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	this<span class="token punctuation">.</span>bullet<span class="token punctuation">.</span>onload <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token function">imageLoaded<span class="token punctuation">(</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
</code><p><code class=" language-javascript"><span class="token comment" spellcheck="true">	// Set images src
</span>	this<span class="token punctuation">.</span>background<span class="token punctuation">.</span>src <span class="token operator">=</span> <span class="token string">"imgs/bg.png"</span><span class="token punctuation">;</span>
	this<span class="token punctuation">.</span>spaceship<span class="token punctuation">.</span>src <span class="token operator">=</span> <span class="token string">"imgs/ship.png"</span><span class="token punctuation">;</span>
	this<span class="token punctuation">.</span>bullet<span class="token punctuation">.</span>src <span class="token operator">=</span> <span class="token string">"imgs/bullet.png"</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></p></pre></div><p>We first load the two new images used for the ship and the bullets the ship fires, and then set their <code>src</code> attributes. The main change though is the addition of the <code>imageLoaded()</code> function.</p><p>The <code>imageLoaded()&nbsp;</code>function is used to determine when all game assets (in this case images) have successfully loaded. Once all the games assets&nbsp;are loaded, it will start the game. There are two reasons why we added this function.</p><p>The first reason is that you can use this function to help produce a loading screen with a loading bar. When each new asset calls this function, you can progress the loading bar by the percent of&nbsp;<code>numLoaded/numImages</code>.</p><p>The second (and primary) reason is to fix a bug which was encountered in IE9 and below. When the game would run the <code>game.init()</code>&nbsp;function, the images were not yet fully loaded. This caused the call to&nbsp;<code>imageRepository.ship.width</code> to return 0 since there was no image. This type of bug is known as a <a href="http://en.wikipedia.org/wiki/Race_condition" onclick="javascript:window.open(&#39;http://en.wikipedia.org/wiki/Race_condition&#39;); return false;">race condition</a>. The race was between the image being fully loaded and the call to&nbsp;<code>imageRepository</code>&nbsp;when the image was needed.</p><p>By implementing the <code>imageLoaded()</code>&nbsp;function, we are able to ensure that all images are loaded before they are used, negating the race condition from the original code. It is for this reason that the <code>onload="init()"</code>&nbsp;event was taken out of the <code>&lt;body&gt;</code>&nbsp;tag (because the onload event only takes into account assets loaded in the HTML, not through JavaScript) and moved into the <code>imageLoaded()</code> function.</p><h3 id="the-player-ship" class="sub-title"><a href="http://blog.sklambert.com/html5-canvas-game-the-player-ship/#the-player-ship" class="permalink" title="Link to this section">The Player Ship</a></h3><p>Next, we’ll write the code to handle a player moving and shooting. To start off, we’ll introduce a new data structure called an object pool.</p><p>“An&nbsp;<a href="http://en.wikipedia.org/wiki/Object_pool_pattern" onclick="javascript:window.open(&#39;http://en.wikipedia.org/wiki/Object_pool_pattern&#39;); return false;">object pool</a>&nbsp;is a data structure which reuses old objects so as not to continually create or delete new ones.” When many objects are created or deleted in quick succession (such as our bullets), it can cause the game to lag as it tries to free up the memory used by those objects. We will be using an object pool to help manage all the bullets the player can shoot so that the game does not become lagged down by having to create and delete every single bullet.</p><p>For more information about object pools, <a href="http://gamedev.tutsplus.com/tutorials/implementation/object-pools-help-you-reduce-lag-in-resource-intensive-games/" onclick="javascript:window.open(&#39;http://gamedev.tutsplus.com/tutorials/implementation/object-pools-help-you-reduce-lag-in-resource-intensive-games/&#39;); return false;">check out this article</a> I wrote for <a href="http://gamedev.tutsplus.com/" onclick="javascript:window.open(&#39;http://gamedev.tutsplus.com/&#39;); return false;">Gamedevtuts+</a></p><div class="code-block"><pre class=" language-javascript"><code class=" language-javascript"><span class="token comment" spellcheck="true">/**
 * Custom Pool object. Holds Bullet objects to be managed to prevent
 * garbage collection.
 */</span>
<span class="token keyword">function</span> <span class="token function">Pool<span class="token punctuation">(</span></span>maxSize<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">var</span> size <span class="token operator">=</span> maxSize<span class="token punctuation">;</span><span class="token comment" spellcheck="true"> // Max bullets allowed in the pool
</span>	<span class="token keyword">var</span> pool <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
	<span class="token comment" spellcheck="true">/*
	 * Populates the pool array with Bullet objects
	 */</span>
	this<span class="token punctuation">.</span>init <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> size<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token comment" spellcheck="true">	// Initalize the bullet object
</span>			<span class="token keyword">var</span> bullet <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Bullet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			bullet<span class="token punctuation">.</span><span class="token function">init<span class="token punctuation">(</span></span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span> imageRepository<span class="token punctuation">.</span>bullet<span class="token punctuation">.</span>width<span class="token punctuation">,</span>
			            imageRepository<span class="token punctuation">.</span>bullet<span class="token punctuation">.</span>height<span class="token punctuation">)</span><span class="token punctuation">;</span>
			pool<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> bullet<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span><span class="token punctuation">;</span>
	<span class="token comment" spellcheck="true">/*
	 * Grabs the last item in the list and initializes it and
	 * pushes it to the front of the array.
	 */</span>
	this<span class="token punctuation">.</span>get <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> speed<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>pool<span class="token punctuation">[</span>size <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>alive<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			pool<span class="token punctuation">[</span>size <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">spawn<span class="token punctuation">(</span></span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> speed<span class="token punctuation">)</span><span class="token punctuation">;</span>
			pool<span class="token punctuation">.</span><span class="token function">unshift<span class="token punctuation">(</span></span>pool<span class="token punctuation">.</span><span class="token function">pop<span class="token punctuation">(</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span><span class="token punctuation">;</span>
	<span class="token comment" spellcheck="true">/*
	 * Used for the ship to be able to get two bullets at once. If
	 * only the get() function is used twice, the ship is able to
	 * fire and only have 1 bullet spawn instead of 2.
	 */</span>
	this<span class="token punctuation">.</span>getTwo <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>x1<span class="token punctuation">,</span> y1<span class="token punctuation">,</span> speed1<span class="token punctuation">,</span> x2<span class="token punctuation">,</span> y2<span class="token punctuation">,</span> speed2<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>pool<span class="token punctuation">[</span>size <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>alive <span class="token operator">&amp;&amp;</span>
		   <span class="token operator">!</span>pool<span class="token punctuation">[</span>size <span class="token operator">-</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">.</span>alive<span class="token punctuation">)</span> <span class="token punctuation">{</span>
				this<span class="token punctuation">.</span><span class="token function">get<span class="token punctuation">(</span></span>x1<span class="token punctuation">,</span> y1<span class="token punctuation">,</span> speed1<span class="token punctuation">)</span><span class="token punctuation">;</span>
				this<span class="token punctuation">.</span><span class="token function">get<span class="token punctuation">(</span></span>x2<span class="token punctuation">,</span> y2<span class="token punctuation">,</span> speed2<span class="token punctuation">)</span><span class="token punctuation">;</span>
			 <span class="token punctuation">}</span>
	<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code><p><code class=" language-javascript">	<span class="token comment" spellcheck="true">/*
	 * Draws any in use Bullets. If a bullet goes off the screen,
	 * clears it and pushes it to the front of the array.
	 */</span>
	this<span class="token punctuation">.</span>animate <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> size<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token comment" spellcheck="true">	// Only draw until we find a bullet that is not alive
</span>			<span class="token keyword">if</span> <span class="token punctuation">(</span>pool<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>alive<span class="token punctuation">)</span> <span class="token punctuation">{</span>
				<span class="token keyword">if</span> <span class="token punctuation">(</span>pool<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">draw<span class="token punctuation">(</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
					pool<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">clear<span class="token punctuation">(</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
					pool<span class="token punctuation">.</span><span class="token function">push<span class="token punctuation">(</span></span><span class="token punctuation">(</span>pool<span class="token punctuation">.</span><span class="token function">splice<span class="token punctuation">(</span></span>i<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span>
			<span class="token punctuation">}</span>
			<span class="token keyword">else</span>
				<span class="token keyword">break</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></p></pre></div><p>When the pool is initialized, it&nbsp;populates&nbsp;an array with empty <code>Bullet</code> objects which will be reused every time a bullet is created.&nbsp;When the pool needs to create a new bullet for use, it looks at the last item in the array and checks to see if it is currently&nbsp;in use. If it is in use, the pool is full and no bullets can be spawned. If it is&nbsp;not in use, the pool spawns the last item in the array and&nbsp;then pops it from the back and pushes it onto the front of&nbsp;the array. This makes the pool have free bullets in the back and used bullets&nbsp;in the front.</p><p>When the pool animates the bullets, it checks to see if the bullet&nbsp;is in use (no need to draw unused bullets) and if it is, draws it. If the <code>draw()</code> function returns true, the bullet&nbsp;is ready to be reused and the pool clears the bullet&nbsp;and removes it from the array and pushes it to the back.&nbsp;Doing this makes creating/destroying bullets&nbsp;in the pool have <a href="http://en.wikipedia.org/wiki/Time_complexity#Constant_time" onclick="javascript:window.open(&#39;http://en.wikipedia.org/wiki/Time_complexity#Constant_time&#39;); return false;">constant time</a>.</p><p>With the object pool in hand, we can now create the bullet object.</p><div class="code-block"><pre class=" language-javascript"><code class=" language-javascript"><span class="token comment" spellcheck="true">/**
 * Creates the Bullet object which the ship fires. The bullets are
 * drawn on the "main" canvas.
 */</span>
<span class="token keyword">function</span> <span class="token function">Bullet<span class="token punctuation">(</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	this<span class="token punctuation">.</span>alive <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true"> // Is true if the bullet is currently in use
</span>	<span class="token comment" spellcheck="true">/*
	 * Sets the bullet values
	 */</span>
	this<span class="token punctuation">.</span>spawn <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> speed<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		this<span class="token punctuation">.</span>x <span class="token operator">=</span> x<span class="token punctuation">;</span>
		this<span class="token punctuation">.</span>y <span class="token operator">=</span> y<span class="token punctuation">;</span>
		this<span class="token punctuation">.</span>speed <span class="token operator">=</span> speed<span class="token punctuation">;</span>
		this<span class="token punctuation">.</span>alive <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span><span class="token punctuation">;</span>
	<span class="token comment" spellcheck="true">/*
	 * Uses a "drity rectangle" to erase the bullet and moves it.
	 * Returns true if the bullet moved off the screen, indicating that
	 * the bullet is ready to be cleared by the pool, otherwise draws
	 * the bullet.
	 */</span>
	this<span class="token punctuation">.</span>draw <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		this<span class="token punctuation">.</span>context<span class="token punctuation">.</span><span class="token function">clearRect<span class="token punctuation">(</span></span>this<span class="token punctuation">.</span>x<span class="token punctuation">,</span> this<span class="token punctuation">.</span>y<span class="token punctuation">,</span> this<span class="token punctuation">.</span>width<span class="token punctuation">,</span> this<span class="token punctuation">.</span>height<span class="token punctuation">)</span><span class="token punctuation">;</span>
		this<span class="token punctuation">.</span>y <span class="token operator">-</span><span class="token operator">=</span> this<span class="token punctuation">.</span>speed<span class="token punctuation">;</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>this<span class="token punctuation">.</span>y <span class="token operator">&lt;=</span> <span class="token number">0</span> – this<span class="token punctuation">.</span>height<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">else</span> <span class="token punctuation">{</span>
			this<span class="token punctuation">.</span>context<span class="token punctuation">.</span><span class="token function">drawImage<span class="token punctuation">(</span></span>imageRepository<span class="token punctuation">.</span>bullet<span class="token punctuation">,</span> this<span class="token punctuation">.</span>x<span class="token punctuation">,</span> this<span class="token punctuation">.</span>y<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code><p><code class=" language-javascript">	<span class="token comment" spellcheck="true">/*
	 * Resets the bullet values
	 */</span>
	this<span class="token punctuation">.</span>clear <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		this<span class="token punctuation">.</span>x <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
		this<span class="token punctuation">.</span>y <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
		this<span class="token punctuation">.</span>speed <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
		this<span class="token punctuation">.</span>alive <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
Bullet<span class="token punctuation">.</span>prototype <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Drawable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></p></pre></div><p>The <code>Bullet</code> object sets the initial state of the bullet by setting alive to be false. It then defines three methods: spawn, draw, and clear.&nbsp;The spawn method is used to create a new bullet and takes an <code>x</code> and <code>y</code> value as well as the speed of the bullet, setting variables accordingly.</p><h3 id="dirty-rectangles" class="sub-title"><a href="http://blog.sklambert.com/html5-canvas-game-the-player-ship/#dirty-rectangles" class="permalink" title="Link to this section">Dirty Rectangles</a></h3><p>In the draw method we use a technique known as a <a href="http://code.bytespider.eu/post/21438674255/dirty-rectangles" onclick="javascript:window.open(&#39;http://code.bytespider.eu/post/21438674255/dirty-rectangles&#39;); return false;">dirty rectangle</a>&nbsp;to clear only the immediate area around the bullet. If the bullet goes off the screen, the method returns true signifying it is ready to be reused, otherwise it redraws it.</p><p>Dirty rectangles are a <a href="http://www.html5rocks.com/en/tutorials/canvas/performance/#toc-render-diff" onclick="javascript:window.open(&#39;http://www.html5rocks.com/en/tutorials/canvas/performance/#toc-render-diff&#39;); return false;">great performance boost</a>&nbsp;because clearing the whole canvas is expensive while clearing a small section of the canvas is cheap. Thus, anytime we draw objects to the screen, we will be using dirty rectangles to clear them from the canvas before we redraw them, and we will only redraw those objects that have moved since the last frame.</p><blockquote><p>When working with animation on canvas, performance can be a challenge since bitmap operations are very processing expensive, especially at high resolutions. One important optimization rule to follow is to reuse as many pixels as possible between frames. What I mean by that is the fewer pixels that need to be processed each frame, the faster your program will run. A good example of this is when erasing pixels with the&nbsp;<em>clearRect(x,y,w,h)&nbsp;</em>method, it is very beneficial to clear and redraw only the pixels that have changed and not the full canvas. Unlike the Flash Player’s redraw regions, this management of “dirty rectangles” needs to be done manually for canvas. -&nbsp;<a href="http://hakim.se/thoughts/canvas-tips" onclick="javascript:window.open(&#39;http://hakim.se/thoughts/canvas-tips&#39;); return false;">Hakim El Hattab</a></p></blockquote><p>Dirty Rectangles are the reason we split the game up into three canvases. If were only to have one canvas, we would have to paint it in order of bottom to top. The background would be drawn first, then the ship and bullets. Doing it this way would cause us to have to redraw everything each frame, which is expensive.</p><p>If we were only to have two canvases, the background would redraw each frame but the ship could be drawn only when it has moved. The bullets would be redrawn each frame using a dirty rectangle, but if the bullet overlaps the ship, part of the ship would be cleared as well. If they player hadn’t moved since the last frame, the ship would not be redraw so the cleared section would remain until the player moved. Not the best effect visually.</p><p>So we use three canvases so we can dirty box the bullets without having to clear the ship if the bullet overlaps it. Performance is kept and visually nothing looks&nbsp;askew. This same technique was used in the browser game <a href="http://www.contrejour.ie/" onclick="javascript:window.open(&#39;http://www.contrejour.ie/&#39;); return false;">Contre Jour</a>. <a href="http://www.contrejour.ie/BehindTheScenes.html" onclick="javascript:window.open(&#39;http://www.contrejour.ie/BehindTheScenes.html&#39;); return false;">Each platform</a> is drawn on it’s own canvas to help speed up&nbsp;performance.</p><p>The last method of the bullet object is the clear method. This method just resets all the variables set by the spawn method so that the object can be reused.</p><h3 id="the-ship-object" class="sub-title"><a href="http://blog.sklambert.com/html5-canvas-game-the-player-ship/#the-ship-object" class="permalink" title="Link to this section">The Ship Object</a></h3><p>The last object we need to create is the ship object.</p><div class="code-block"><pre class=" language-javascript"><code class=" language-javascript"><span class="token comment" spellcheck="true">/**
 * Create the Ship object that the player controls. The ship is
 * drawn on the "ship" canvas and uses dirty rectangles to move
 * around the screen.
 */</span>
<span class="token keyword">function</span> <span class="token function">Ship<span class="token punctuation">(</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	this<span class="token punctuation">.</span>speed <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>
	this<span class="token punctuation">.</span>bulletPool <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Pool</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	this<span class="token punctuation">.</span>bulletPool<span class="token punctuation">.</span><span class="token function">init<span class="token punctuation">(</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">var</span> fireRate <span class="token operator">=</span> <span class="token number">15</span><span class="token punctuation">;</span>
	<span class="token keyword">var</span> counter <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
	this<span class="token punctuation">.</span>draw <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		this<span class="token punctuation">.</span>context<span class="token punctuation">.</span><span class="token function">drawImage<span class="token punctuation">(</span></span>imageRepository<span class="token punctuation">.</span>spaceship<span class="token punctuation">,</span> this<span class="token punctuation">.</span>x<span class="token punctuation">,</span> this<span class="token punctuation">.</span>y<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span><span class="token punctuation">;</span>
	this<span class="token punctuation">.</span>move <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		counter<span class="token operator">++</span><span class="token punctuation">;</span>
	<span class="token comment" spellcheck="true">	// Determine if the action is move action
</span>		<span class="token keyword">if</span> <span class="token punctuation">(</span>KEY_STATUS<span class="token punctuation">.</span>left <span class="token operator">||</span> KEY_STATUS<span class="token punctuation">.</span>right <span class="token operator">||</span>
			KEY_STATUS<span class="token punctuation">.</span>down <span class="token operator">||</span> KEY_STATUS<span class="token punctuation">.</span>up<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token comment" spellcheck="true">	// The ship moved, so erase it’s current image so it can
</span>		<span class="token comment" spellcheck="true">	// be redrawn in it’s new location
</span>			this<span class="token punctuation">.</span>context<span class="token punctuation">.</span><span class="token function">clearRect<span class="token punctuation">(</span></span>this<span class="token punctuation">.</span>x<span class="token punctuation">,</span> this<span class="token punctuation">.</span>y<span class="token punctuation">,</span> this<span class="token punctuation">.</span>width<span class="token punctuation">,</span> this<span class="token punctuation">.</span>height<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token comment" spellcheck="true">	// Update x and y according to the direction to move and
</span>		<span class="token comment" spellcheck="true">	// redraw the ship. Change the else if’s to if statements
</span>		<span class="token comment" spellcheck="true">	// to have diagonal movement.
</span>			<span class="token keyword">if</span> <span class="token punctuation">(</span>KEY_STATUS<span class="token punctuation">.</span>left<span class="token punctuation">)</span> <span class="token punctuation">{</span>
				this<span class="token punctuation">.</span>x <span class="token operator">-</span><span class="token operator">=</span> this<span class="token punctuation">.</span>speed
				<span class="token keyword">if</span> <span class="token punctuation">(</span>this<span class="token punctuation">.</span>x <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true"> // Keep player within the screen
</span>					this<span class="token punctuation">.</span>x <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>KEY_STATUS<span class="token punctuation">.</span>right<span class="token punctuation">)</span> <span class="token punctuation">{</span>
				this<span class="token punctuation">.</span>x <span class="token operator">+</span><span class="token operator">=</span> this<span class="token punctuation">.</span>speed
				<span class="token keyword">if</span> <span class="token punctuation">(</span>this<span class="token punctuation">.</span>x <span class="token operator">&gt;=</span> this<span class="token punctuation">.</span>canvasWidth – this<span class="token punctuation">.</span>width<span class="token punctuation">)</span>
					this<span class="token punctuation">.</span>x <span class="token operator">=</span> this<span class="token punctuation">.</span>canvasWidth – this<span class="token punctuation">.</span>width<span class="token punctuation">;</span>
			<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>KEY_STATUS<span class="token punctuation">.</span>up<span class="token punctuation">)</span> <span class="token punctuation">{</span>
				this<span class="token punctuation">.</span>y <span class="token operator">-</span><span class="token operator">=</span> this<span class="token punctuation">.</span>speed
				<span class="token keyword">if</span> <span class="token punctuation">(</span>this<span class="token punctuation">.</span>y <span class="token operator">&lt;=</span> this<span class="token punctuation">.</span>canvasHeight<span class="token operator">/</span><span class="token number">4</span><span class="token operator">*</span><span class="token number">3</span><span class="token punctuation">)</span>
					this<span class="token punctuation">.</span>y <span class="token operator">=</span> this<span class="token punctuation">.</span>canvasHeight<span class="token operator">/</span><span class="token number">4</span><span class="token operator">*</span><span class="token number">3</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>KEY_STATUS<span class="token punctuation">.</span>down<span class="token punctuation">)</span> <span class="token punctuation">{</span>
				this<span class="token punctuation">.</span>y <span class="token operator">+</span><span class="token operator">=</span> this<span class="token punctuation">.</span>speed
				<span class="token keyword">if</span> <span class="token punctuation">(</span>this<span class="token punctuation">.</span>y <span class="token operator">&gt;=</span> this<span class="token punctuation">.</span>canvasHeight – this<span class="token punctuation">.</span>height<span class="token punctuation">)</span>
					this<span class="token punctuation">.</span>y <span class="token operator">=</span> this<span class="token punctuation">.</span>canvasHeight – this<span class="token punctuation">.</span>height<span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
		<span class="token comment" spellcheck="true">	// Finish by redrawing the ship
</span>			this<span class="token punctuation">.</span><span class="token function">draw<span class="token punctuation">(</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>KEY_STATUS<span class="token punctuation">.</span>space <span class="token operator">&amp;&amp;</span> counter <span class="token operator">&gt;=</span> fireRate<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			this<span class="token punctuation">.</span><span class="token function">fire<span class="token punctuation">(</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			counter <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code><p><code class=" language-javascript">	<span class="token comment" spellcheck="true">/*
	 * Fires two bullets
	 */</span>
	this<span class="token punctuation">.</span>fire <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		this<span class="token punctuation">.</span>bulletPool<span class="token punctuation">.</span><span class="token function">getTwo<span class="token punctuation">(</span></span>this<span class="token punctuation">.</span>x<span class="token operator">+</span><span class="token number">6</span><span class="token punctuation">,</span> this<span class="token punctuation">.</span>y<span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span>
		                       this<span class="token punctuation">.</span>x<span class="token operator">+</span><span class="token number">33</span><span class="token punctuation">,</span> this<span class="token punctuation">.</span>y<span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
Ship<span class="token punctuation">.</span>prototype <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Drawable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></p></pre></div><p>The <code>ship</code> object sets the speed of the ship to 3 pixels per frame and creates the object pool for the ships bullets. It then sets the ships fire rate to be able to shoot once every 15 frames, using <code>counter</code> to determine when it can shoot. The ship has three methods as well: draw, move, and fire.</p><p>The draw method just draws the ship to the screen. The move method first increments the counter variable, then determines if the ship has moved based on keyboard input (to be described next). Based on the keyboard input, it moves the ship and then ensures that it doesn’t go off the screen. The ship in our game will only be able to move 1/4 of the way up the screen, so it will use that as the&nbsp;up-most&nbsp;boundary.</p><p>The last thing the draw method does is determine if the player is firing using the keyboard input and can fire based on the fire rate. If the ship can fire, it calls the <code>fire()</code> method and resets the counter to 0.</p><p>The fire method calls the object pools <code>getTwo()</code> method to get two bullets at once, and positions them just above the two guns of the ship, setting their speed to 3 pixels per frame as well.</p><p>To get the keyboard input for the game, we will use a technique developed by <a href="http://dougmcinnes.com/2010/05/12/html-5-asteroids/" onclick="javascript:window.open(&#39;http://dougmcinnes.com/2010/05/12/html-5-asteroids/&#39;); return false;">Doug McInnes</a> when he created Asteroids for the canvas.</p><div class="code-block"><pre class=" language-javascript"><code class=" language-javascript"><span class="token comment" spellcheck="true">// The keycodes that will be mapped when a user presses a button.
</span><span class="token comment" spellcheck="true">// Original code by Doug McInnes
</span>KEY_CODES <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token number">32</span><span class="token punctuation">:</span> ‘space’<span class="token punctuation">,</span>
  <span class="token number">37</span><span class="token punctuation">:</span> ‘left’<span class="token punctuation">,</span>
  <span class="token number">38</span><span class="token punctuation">:</span> ‘up’<span class="token punctuation">,</span>
  <span class="token number">39</span><span class="token punctuation">:</span> ‘right’<span class="token punctuation">,</span>
  <span class="token number">40</span><span class="token punctuation">:</span> ‘down’<span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code><p><code class=" language-javascript"><span class="token comment" spellcheck="true">// Creates the array to hold the KEY_CODES and sets all their values
</span><span class="token comment" spellcheck="true">// to false. Checking true/flase is the quickest way to check status
</span><span class="token comment" spellcheck="true">// of a key press and which one was pressed when determining
</span><span class="token comment" spellcheck="true">// when to move and which direction.
</span>KEY_STATUS <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span>code <span class="token keyword">in</span> KEY_CODES<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  KEY_STATUS<span class="token punctuation">[</span> KEY_CODES<span class="token punctuation">[</span> code <span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment" spellcheck="true">/**
 * Sets up the document to listen to onkeydown events (fired when
 * any key on the keyboard is pressed down). When a key is pressed,
 * it sets the appropriate direction to true to let us know which
 * key it was.
 */</span>
document<span class="token punctuation">.</span>onkeydown <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
 <span class="token comment" spellcheck="true"> // Firefox and opera use charCode instead of keyCode to
</span> <span class="token comment" spellcheck="true"> // return which key was pressed.
</span>  <span class="token keyword">var</span> keyCode <span class="token operator">=</span> <span class="token punctuation">(</span>e<span class="token punctuation">.</span>keyCode<span class="token punctuation">)</span> <span class="token operator">?</span> e<span class="token punctuation">.</span>keyCode <span class="token punctuation">:</span> e<span class="token punctuation">.</span>charCode<span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>KEY_CODES<span class="token punctuation">[</span>keyCode<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    e<span class="token punctuation">.</span><span class="token function">preventDefault<span class="token punctuation">(</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    KEY_STATUS<span class="token punctuation">[</span>KEY_CODES<span class="token punctuation">[</span>keyCode<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment" spellcheck="true">/**
 * Sets up the document to listen to ownkeyup events (fired when
 * any key on the keyboard is released). When a key is released,
 * it sets teh appropriate direction to false to let us know which
 * key it was.
 */</span>
document<span class="token punctuation">.</span>onkeyup <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> keyCode <span class="token operator">=</span> <span class="token punctuation">(</span>e<span class="token punctuation">.</span>keyCode<span class="token punctuation">)</span> <span class="token operator">?</span> e<span class="token punctuation">.</span>keyCode <span class="token punctuation">:</span> e<span class="token punctuation">.</span>charCode<span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>KEY_CODES<span class="token punctuation">[</span>keyCode<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    e<span class="token punctuation">.</span><span class="token function">preventDefault<span class="token punctuation">(</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    KEY_STATUS<span class="token punctuation">[</span>KEY_CODES<span class="token punctuation">[</span>keyCode<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></p></pre></div><p>The code first creates a <a href="http://en.wikipedia.org/wiki/JSON" onclick="javascript:window.open(&#39;http://en.wikipedia.org/wiki/JSON&#39;); return false;">JSON </a>object that holds the <a href="http://www.cambiaresearch.com/articles/15/javascript-char-codes-key-codes" onclick="javascript:window.open(&#39;http://www.cambiaresearch.com/articles/15/javascript-char-codes-key-codes&#39;); return false;">keycodes</a> for each keyboard key and what that means for our game (ex. left arrow = left). It also creates an array of statuses of true/false so that we know when a key is pressed. It then creates the <code>onkeydown</code> and <code>onkeyup</code> events to trigger the key status change of a key.</p><h3 id="the-final-step" class="sub-title"><a href="http://blog.sklambert.com/html5-canvas-game-the-player-ship/#the-final-step" class="permalink" title="Link to this section">The Final Step</a></h3><p>The last thing we need to do to is update the game object and the animate function.</p><div class="code-block"><pre class=" language-javascript"><code class=" language-javascript"> <span class="token comment" spellcheck="true">/**
 * Creates the Game object which will hold all objects and data for
 * the game.
 */</span>
<span class="token keyword">function</span> <span class="token function">Game<span class="token punctuation">(</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token comment" spellcheck="true">/*
	 * Gets canvas information and context and sets up all game
	 * objects.
	 * Returns true if the canvas is supported and false if it
	 * is not. This is to stop the animation script from constantly
	 * running on browsers that do not support the canvas.
	 */</span>
	this<span class="token punctuation">.</span>init <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token comment" spellcheck="true">	// Get the canvas elements
</span>		this<span class="token punctuation">.</span>bgCanvas <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById<span class="token punctuation">(</span></span>‘background’<span class="token punctuation">)</span><span class="token punctuation">;</span>
		this<span class="token punctuation">.</span>shipCanvas <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById<span class="token punctuation">(</span></span>‘ship’<span class="token punctuation">)</span><span class="token punctuation">;</span>
		this<span class="token punctuation">.</span>mainCanvas <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById<span class="token punctuation">(</span></span>‘main’<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment" spellcheck="true">	// Test to see if canvas is supported. Only need to
</span>	<span class="token comment" spellcheck="true">	// check one canvas
</span>		<span class="token keyword">if</span> <span class="token punctuation">(</span>this<span class="token punctuation">.</span>bgCanvas<span class="token punctuation">.</span>getContext<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			this<span class="token punctuation">.</span>bgContext <span class="token operator">=</span> this<span class="token punctuation">.</span>bgCanvas<span class="token punctuation">.</span><span class="token function">getContext<span class="token punctuation">(</span></span>’2d’<span class="token punctuation">)</span><span class="token punctuation">;</span>
			this<span class="token punctuation">.</span>shipContext <span class="token operator">=</span> this<span class="token punctuation">.</span>shipCanvas<span class="token punctuation">.</span><span class="token function">getContext<span class="token punctuation">(</span></span>’2d’<span class="token punctuation">)</span><span class="token punctuation">;</span>
			this<span class="token punctuation">.</span>mainContext <span class="token operator">=</span> this<span class="token punctuation">.</span>mainCanvas<span class="token punctuation">.</span><span class="token function">getContext<span class="token punctuation">(</span></span>’2d’<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token comment" spellcheck="true">	// Initialize objects to contain their context and canvas
</span>		<span class="token comment" spellcheck="true">	// information
</span>			Background<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>context <span class="token operator">=</span> this<span class="token punctuation">.</span>bgContext<span class="token punctuation">;</span>
			Background<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>canvasWidth <span class="token operator">=</span> this<span class="token punctuation">.</span>bgCanvas<span class="token punctuation">.</span>width<span class="token punctuation">;</span>
			Background<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>canvasHeight <span class="token operator">=</span> this<span class="token punctuation">.</span>bgCanvas<span class="token punctuation">.</span>height<span class="token punctuation">;</span>
			Ship<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>context <span class="token operator">=</span> this<span class="token punctuation">.</span>shipContext<span class="token punctuation">;</span>
			Ship<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>canvasWidth <span class="token operator">=</span> this<span class="token punctuation">.</span>shipCanvas<span class="token punctuation">.</span>width<span class="token punctuation">;</span>
			Ship<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>canvasHeight <span class="token operator">=</span> this<span class="token punctuation">.</span>shipCanvas<span class="token punctuation">.</span>height<span class="token punctuation">;</span>
			Bullet<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>context <span class="token operator">=</span> this<span class="token punctuation">.</span>mainContext<span class="token punctuation">;</span>
			Bullet<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>canvasWidth <span class="token operator">=</span> this<span class="token punctuation">.</span>mainCanvas<span class="token punctuation">.</span>width<span class="token punctuation">;</span>
			Bullet<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>canvasHeight <span class="token operator">=</span> this<span class="token punctuation">.</span>mainCanvas<span class="token punctuation">.</span>height<span class="token punctuation">;</span>
		<span class="token comment" spellcheck="true">	// Initialize the background object
</span>			this<span class="token punctuation">.</span>background <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Background</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			this<span class="token punctuation">.</span>background<span class="token punctuation">.</span><span class="token function">init<span class="token punctuation">(</span></span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true"> // Set draw point to 0,0
</span>		<span class="token comment" spellcheck="true">	// Initialize the ship object
</span>			this<span class="token punctuation">.</span>ship <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Ship</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token comment" spellcheck="true">	// Set the ship to start near the bottom middle of the canvas
</span>			<span class="token keyword">var</span> shipStartX <span class="token operator">=</span> this<span class="token punctuation">.</span>shipCanvas<span class="token punctuation">.</span>width<span class="token operator">/</span><span class="token number">2</span> – imageRepository<span class="token punctuation">.</span>spaceship<span class="token punctuation">.</span>width<span class="token punctuation">;</span>
			<span class="token keyword">var</span> shipStartY <span class="token operator">=</span> this<span class="token punctuation">.</span>shipCanvas<span class="token punctuation">.</span>height<span class="token operator">/</span><span class="token number">4</span><span class="token operator">*</span><span class="token number">3</span> <span class="token operator">+</span> imageRepository<span class="token punctuation">.</span>spaceship<span class="token punctuation">.</span>height<span class="token operator">*</span><span class="token number">2</span><span class="token punctuation">;</span>
			this<span class="token punctuation">.</span>ship<span class="token punctuation">.</span><span class="token function">init<span class="token punctuation">(</span></span>shipStartX<span class="token punctuation">,</span> shipStartY<span class="token punctuation">,</span> imageRepository<span class="token punctuation">.</span>spaceship<span class="token punctuation">.</span>width<span class="token punctuation">,</span>
			               imageRepository<span class="token punctuation">.</span>spaceship<span class="token punctuation">.</span>height<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
			<span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">	// Start the animation loop
</span>	this<span class="token punctuation">.</span>start <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		this<span class="token punctuation">.</span>ship<span class="token punctuation">.</span><span class="token function">draw<span class="token punctuation">(</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">animate<span class="token punctuation">(</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code><p><code class=" language-javascript"><span class="token comment" spellcheck="true">/**
 * The animation loop. Calls the requestAnimationFrame shim to
 * optimize the game loop and draws all game objects. This
 * function must be a gobal function and cannot be within an
 * object.
 */</span>
<span class="token keyword">function</span> <span class="token function">animate<span class="token punctuation">(</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token function">requestAnimFrame<span class="token punctuation">(</span></span> animate <span class="token punctuation">)</span><span class="token punctuation">;</span>
	game<span class="token punctuation">.</span>background<span class="token punctuation">.</span><span class="token function">draw<span class="token punctuation">(</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	game<span class="token punctuation">.</span>ship<span class="token punctuation">.</span><span class="token function">move<span class="token punctuation">(</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	game<span class="token punctuation">.</span>ship<span class="token punctuation">.</span>bulletPool<span class="token punctuation">.</span><span class="token function">animate<span class="token punctuation">(</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></p></pre></div><p>The game gets each canvases information and sets each objects canvas accordingly. It then initializes the background and the ship object, placing it near the bottom middle of the canvas to start.</p><p>The animate function just needs to call the <code>move()</code> function and the object pool <code>animate()</code> function to have them animate.</p><p>Whew, that’s it! You should now have a game with a ship being able to move and shoot.</p><h2 id="conclusion" class="sub-title"><a href="http://blog.sklambert.com/html5-canvas-game-the-player-ship/#conclusion" class="permalink" title="Link to this section">Conclusion</a></h2><p>That was a pretty long tutorial, but there were a lot of good techniques&nbsp;discussed, such as object pools, dirty boxing, and multiple canvases. Each of these techniques help to increase the performance of our game and ensure we can maintain 60FPS.</p><p>In the next tutorial, we’ll create the enemy ships and give them a pattern to move on the screen, as well as a shooting pattern.</p><div class="zem_rp_wrap zem_rp_th_vertical_m" id="zem_rp_first"><div class="zem_rp_content"><h3 class="related_post_title">Related Posts</h3><ul class="related_post zem_rp" style="visibility: visible"><li data-position="0" data-poid="in-688" data-post-type="none"><a href="http://blog.sklambert.com/html5-canvas-game-the-enemy-ships/" class="zem_rp_thumbnail"><img src="./HTML5 Canvas Game  Moving with Dirty Rectangles - Programming Tutorials, Tips, and Tricks_files/enemies_on_bg.png" alt="HTML5 Canvas Game: The Enemy Ships" width="100" height="100"></a><a href="http://blog.sklambert.com/html5-canvas-game-the-enemy-ships/" class="zem_rp_title">HTML5 Canvas Game: The Enemy Ships</a></li><li data-position="1" data-poid="in-882" data-post-type="none"><a href="http://blog.sklambert.com/html5-canvas-game-html5-audio-and-finishing-touches/" class="zem_rp_thumbnail"><img src="./HTML5 Canvas Game  Moving with Dirty Rectangles - Programming Tutorials, Tips, and Tricks_files/collision_detection.png" alt="HTML5 Canvas Game: HTML5 Audio and Finishing Touches" width="100" height="100"></a><a href="http://blog.sklambert.com/html5-canvas-game-html5-audio-and-finishing-touches/" class="zem_rp_title">HTML5 Canvas Game: HTML5 Audio and Finishing Touches</a></li><li data-position="2" data-poid="in-450" data-post-type="none"><a href="http://blog.sklambert.com/html5-canvas-game-panning-a-background/" class="zem_rp_thumbnail"><img src="./HTML5 Canvas Game  Moving with Dirty Rectangles - Programming Tutorials, Tips, and Tricks_files/bg.png" alt="HTML5 Canvas Game: Panning a Background" width="100" height="100"></a><a href="http://blog.sklambert.com/html5-canvas-game-panning-a-background/" class="zem_rp_title">HTML5 Canvas Game: Panning a Background</a></li><li data-position="3" data-poid="in-716" data-post-type="none"><a href="http://blog.sklambert.com/html5-canvas-game-2d-collision-detection/" class="zem_rp_thumbnail"><img src="./HTML5 Canvas Game  Moving with Dirty Rectangles - Programming Tutorials, Tips, and Tricks_files/collision_detection.png" alt="HTML5 Canvas Game: 2D Collision Detection" width="100" height="100"></a><a href="http://blog.sklambert.com/html5-canvas-game-2d-collision-detection/" class="zem_rp_title">HTML5 Canvas Game: 2D Collision Detection</a></li><li data-position="4" data-poid="in-20" data-post-type="none"><a href="http://blog.sklambert.com/galaxian-html5-game/" class="zem_rp_thumbnail"><img src="./HTML5 Canvas Game  Moving with Dirty Rectangles - Programming Tutorials, Tips, and Tricks_files/space_shooter.png" alt="Galaxian Style HTML5 Game" width="100" height="100"></a><a href="http://blog.sklambert.com/galaxian-html5-game/" class="zem_rp_title">Galaxian Style HTML5 Game</a></li></ul></div></div><div class="series-next-prev-wrapper bottom"><div class="series-prev"> <a href="http://blog.sklambert.com/html5-canvas-game-panning-a-background/" title="HTML5 Canvas Game: Panning a Background" class="series-prev-link">« Previous series post</a></div><div class="series-next"> <a href="http://blog.sklambert.com/html5-canvas-game-the-enemy-ships/" title="HTML5 Canvas Game: The Enemy Ships" class="series-next-link">Next series post »</a></div></div> </article><div class="comments"><a href="http://blog.sklambert.com/html5-canvas-game-the-player-ship/#disqus_thread" class="show-comments">30 Comments</a></div><div id="disqus_thread"></div> </section><aside class="secondary" role="complementary"><div id="social" class="widget"><ul class="social"><li class="social-listItem"><a href="http://blog.sklambert.com/feed/rss/" id="rss" class="social-link icon-feed" title="Subscribe to my RSS feed"></a></li><li class="social-listItem"><a href="https://twitter.com/StevenKLambert" id="twitter" class="social-link icon-twitter" title="Follow me on Twitter" onclick="javascript:window.open(&#39;https://twitter.com/StevenKLambert&#39;); return false;"></a></li><li class="social-listItem"><a href="https://plus.google.com/u/0/+StevenLambertK/" id="google-plus" class="social-link icon-google-plus" title="Connect with me on Google+" onclick="javascript:window.open(&#39;https://plus.google.com/u/0/+StevenLambertK/&#39;); return false;"></a></li><li class="social-listItem"><a href="https://github.com/straker" id="github" class="social-link icon-github" title="View my GitHub profile" onclick="javascript:window.open(&#39;https://github.com/straker&#39;); return false;"></a></li><li class="social-listItem"><a href="mailto:steven@sklambert.com" id="email" class="social-link icon-mail" title="Send me an email"></a></li></ul></div><section id="blog_subscription-2" class="widget jetpack_subscription_widget section"><h3 class="widget-title"><label for="subscribe-field"></label></h3><form action="" method="post" accept-charset="utf-8" id="subscribe-blog-blog_subscription-2"><p id="subscribe-text"></p><p id="subscribe-email"><input type="text" name="email" value="Email Address" id="subscribe-field" onclick="if ( this.value == &#39;Email Address&#39; ) { this.value = &#39;&#39;; }" onblur="if ( this.value == &#39;&#39; ) { this.value = &#39;Email Address&#39;; }"></p><p id="subscribe-submit"> <input type="hidden" name="action" value="subscribe"> <input type="hidden" name="source" value="http://blog.sklambert.com/html5-canvas-game-the-player-ship/"> <input type="hidden" name="sub-type" value="widget"> <input type="hidden" name="redirect_fragment" value="blog_subscription-2"> <input type="submit" value="Subscribe" name="jetpack_subscriptions_widget"></p></form> </section><section id="text-2" class="widget widget_text section"><h3 class="widget-title">About Steven Lambert</h3><div class="textwidget"><img class="about-me-image" src="./HTML5 Canvas Game  Moving with Dirty Rectangles - Programming Tutorials, Tips, and Tricks_files/me.png">I started out my career as a web developer while I was still in college, but I have always had a fasination with making games. When the possibility of making games using HTML5 was introduced, I couldn't help but try my hand at it. Since then, I have made a few games and created this blog to help others understand the current state of the web as it applies to HTML5 game development.</div> </section><style>.JPV_list{overflow:hidden}.JPV_thumbnail{width:45%}.JPV_thumbnail>.JPV_thumbnail_img{max-width:125px;height:auto}.JPV_thumbnail+.JPV_text{width:45%;padding-bottom:10px;text-align:center;margin-top:-5px}.JPV_thumbnail_title{float:left;width:21.276596%}.JPV_thumbnail_title>.JPV_thumbnail_img{max-width:40px;height:auto}.JPV_thumbnail_title+.JPV_text{float:right;width:73.404255%;padding-bottom:10px}</style><section id="jetpack-post-views-widget-2" class="widget jetpack-post-views section"><h3 class="widget-title">Popular Posts</h3><ul><li class="JPV_list"><a href="http://blog.sklambert.com/html5-canvas-game-panning-a-background/" title="HTML5 Canvas Game: Panning a Background" class="JPV_title">HTML5 Canvas Game: Panning a Background</a></li><li class="JPV_list"><a href="http://blog.sklambert.com/html5-canvas-game-2d-collision-detection/" title="HTML5 Canvas Game: 2D Collision Detection" class="JPV_title">HTML5 Canvas Game: 2D Collision Detection</a></li><li class="JPV_list"><a href="./HTML5 Canvas Game  Moving with Dirty Rectangles - Programming Tutorials, Tips, and Tricks_files/HTML5 Canvas Game  Moving with Dirty Rectangles - Programming Tutorials, Tips, and Tricks.html" title="HTML5 Canvas Game: The Player Ship" class="JPV_title">HTML5 Canvas Game: The Player Ship</a></li><li class="JPV_list"><a href="http://blog.sklambert.com/galaxian-html5-game/" title="Galaxian Style HTML5 Game" class="JPV_title">Galaxian Style HTML5 Game</a></li><li class="JPV_list"><a href="http://blog.sklambert.com/html5-canvas-game-html5-audio-and-finishing-touches/" title="HTML5 Canvas Game: HTML5 Audio and Finishing Touches" class="JPV_title">HTML5 Canvas Game: HTML5 Audio and Finishing Touches</a></li></ul></section> <section id="recent-posts-2" class="widget widget_recent_entries section"><h3 class="widget-title">Recent Posts</h3><ul><li> <a href="http://blog.sklambert.com/html5-game-tutorial-prototypal-inheritance/">HTML5 Game Tutorial: Prototypal Inheritance</a></li><li> <a href="http://blog.sklambert.com/learn-programming-and-game-development/">How to Learn Programming and Game Development</a></li><li> <a href="http://blog.sklambert.com/html5-game-tutorial-module-pattern/">HTML5 Game Tutorial: The Module Pattern</a></li><li> <a href="http://blog.sklambert.com/using-time-based-animation-implement/">Why You Should be Using Time-based Animation and How to Implement it</a></li><li> <a href="http://blog.sklambert.com/made-first-game-two-days/">How I Made My First Game in Two Days</a></li></ul> </section> </aside></main><footer class="site-footer" role="contentinfo"><div class="container"><p class="section">Copyright © Steven Lambert 2012 - 2014</p></div> </footer><script type="text/javascript">var s=document.getElementById('subscribe-field');if(s)s.removeAttribute('style');</script><script type="text/javascript">/*<![CDATA[*/var disqus_shortname='blogsklambertcom';(function(){var nodes=document.getElementsByTagName('span');for(var i=0,url;i<nodes.length;i++){if(nodes[i].className.indexOf('dsq-postid')!=-1){nodes[i].parentNode.setAttribute('data-disqus-identifier',nodes[i].getAttribute('rel'));url=nodes[i].parentNode.href.split('#',1);if(url.length==1)url=url[0];else url=url[1]
nodes[i].parentNode.href=url+'#disqus_thread';}}
var s=document.createElement('script');s.async=true;s.type='text/javascript';s.src='//'+'disqus.com/forums/'+disqus_shortname+'/count.js';(document.getElementsByTagName('HEAD')[0]||document.getElementsByTagName('BODY')[0]).appendChild(s);}());/*]]>*/</script><div style="display:none"></div><script type="text/javascript">jQuery(document).on('ready post-load',function(){jQuery('a.share-twitter').on('click',function(){window.open(jQuery(this).attr('href'),'wpcomtwitter','menubar=1,resizable=1,width=600,height=350');return false;});});</script><script type="text/javascript">(function(){var po=document.createElement('script');po.type='text/javascript';po.async=true;po.src='https://apis.google.com/js/plusone.js';var s=document.getElementsByTagName('script')[0];s.parentNode.insertBefore(po,s);})();</script><script type="text/javascript">jQuery(document).on('ready post-load',function(){jQuery('a.share-facebook').on('click',function(){window.open(jQuery(this).attr('href'),'wpcomfacebook','menubar=1,resizable=1,width=600,height=400');return false;});});</script><script type="text/javascript" src="./HTML5 Canvas Game  Moving with Dirty Rectangles - Programming Tutorials, Tips, and Tricks_files/M9TPSi0pSEzO1s_NTynNSS3WL8jIL8nPg1IA.js"></script><script type="text/javascript" src="./HTML5 Canvas Game  Moving with Dirty Rectangles - Programming Tutorials, Tips, and Tricks_files/devicepx-jetpack.js"></script><iframe name="oauth2relay488229396" id="oauth2relay488229396" src="./HTML5 Canvas Game  Moving with Dirty Rectangles - Programming Tutorials, Tips, and Tricks_files/postmessageRelay.html" tabindex="-1" style="width: 1px; height: 1px; position: absolute; top: -100px;"></iframe><script type="text/javascript" src="./HTML5 Canvas Game  Moving with Dirty Rectangles - Programming Tutorials, Tips, and Tricks_files/M9Avzs5JzE1KLSoJyUjNTdXPKtbPzU_KzEnVMcAilZ6Ym1qMVaagKLM4FwA.js"></script><script type="text/javascript">var recaptcha_options={"lang":"en"};</script><script type="text/javascript" src="./HTML5 Canvas Game  Moving with Dirty Rectangles - Programming Tutorials, Tips, and Tricks_files/M9TPSi0pSEzO1s_NTynNSS3WL85ILEpNSUxJqQQzM_PSAQ.js"></script><script src="./HTML5 Canvas Game  Moving with Dirty Rectangles - Programming Tutorials, Tips, and Tricks_files/e-201419.js" type="text/javascript"></script><script type="text/javascript">st_go({v:'ext',j:'1:2.9.3',blog:'35860617',post:'621',tz:'-6'});var load_cmc=function(){linktracker_init(35860617,621,2);};if(typeof addLoadEvent!='undefined')addLoadEvent(load_cmc);else load_cmc();</script><img id="wpstats" src="./HTML5 Canvas Game  Moving with Dirty Rectangles - Programming Tutorials, Tips, and Tricks_files/g.gif" alt=""></body></html>